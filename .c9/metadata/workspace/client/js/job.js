{"filter":false,"title":"job.js","tooltip":"/client/js/job.js","undoManager":{"mark":16,"position":16,"stack":[[{"start":{"row":0,"column":0},"end":{"row":194,"column":0},"action":"remove","lines":["var express = require('express');","var Job = require('../model/job');","var pub = require('../public');","var multer = require('multer');","var fs = require('fs');","var router = express.Router();","","//이미지 업로드","var img = multer({","  dest: 'public/img/job/'","});","","//파일 업로드","var file = multer({","  dest: 'public/file/job/'","});","","router.get('/write',function(req,res){","  res.render('write',function(err,result){","\t\tif(!err){","\t\t\tres.end(result);","\t\t}else{","\t\t\tres.end(\"에러 가 뜸!!\");","\t\t\tconsole.log(err);","\t\t}","\t});","});","","router.get('/',function(req,res){","    var page = req.query.page;","    if(page == null){","        page = 1;","    }","    var skipSize = (page-1)*1;","    var limitSize = 1;","    var pageNum = 1;","    var sendData = {};","    var pageNum = 1;","    sendData = pub.loginCheck(req);","    Job.count(function(err,totalCount){","        pageNum = Math.ceil(totalCount/limitSize);","        Job.find().sort({date:-1}).skip(skipSize).limit(limitSize).exec(function(err,job){","            if(job == \"\"){","              sendData.pagination = pageNum;","                sendData.job = null;","            }else{","                sendData.pagination = pageNum;","                sendData.job = jobs;","               ","            }","           res.render('job',sendData,function(err,result){","                if(!err){","                    res.end(result);","                }else{","                    res.end('에러가 뜸!!');","                    console.log(err);","                }","            });","        });","    });","});","","router.post('/send',function(req,res){","  var job = new Job({","      name : req.body.name,","      title : req.body.title,","      inquery_count : req.body.inquery_count,","      date : req.body.date,","      contents : req.body.contents,","      attach_file : req.body.files,","      student_co : req.body.student_co","  });","","  job.save(function(err){","    if(err){","      console.log(err);","      res.json({result : 0});","    }else{","      res.json({result : '/'});","    }","  });","});","","router.get('/detail/get',function(req,res){","  var sendData = {};","  sendData = pub.loginCheck(req);","  Job.findOne({\"_id\":req.query.index},function(err,result){","    if(err){","      res.send(err);","    }else{","      sendData.board = result;","      Job.update({\"_id\":result._id},{$set:{'inquery_count':Number(result.inquery_count)+1}},function(err,result){","        if(err){","          console.log(err);","        }else{","          res.render('detail',sendData,function(err,result){","              if(!err){","                  res.end(result);","              }else{","                  res.end('에러가 뜸');","              }","          });","        }","      });","    }","  })","});","","router.get('/details/get',function(req,res){","  Job.findOne({\"_id\":req.query.index},function(err,result){","    if(err){","      res.send(err);","    }else{","      res.send(result);","    }","  })","});","","router.get('/update/get',function(req,res){","    var sendData = {};","    sendData = pub.loginCheck(req);","    res.render('update',sendData,function(err,result){","        if(!err){","            res.end(result);","        }else{","            res.end('에러가 뜸');","        }","    });","});","","router.get('/update/send',function(req,res){","  Job.findOne({'_id':req.query.id},function(err,result){","    if(err){","      res.send(false);","    }else{","      res.send(result);","    }","  })","});","","router.post('/update/post',function(req,res){","  Job.findById(req.body._id,function(err,contents){","    if(err){","      res.send(err);","    }else{","      contents.student_co = req.body.student_co;","      contents.title = req.body.title;","      contents.contents = req.body.contents;","      contents.date = req.body.date;","      contents.name = req.body.name;","      contents.inquery_count = req.body.inquery_count;","      contents.attach_file = req.body.file;","      ","      contents.save(function(err,contents){","        if(err){","          res.end(err);","        }else{","          res.send('/job');","        }","      })","    }","  })","});","","router.get('/delete',function(req,res){","  Job.findOneAndRemove(req.query.id,function(err){","    if(err){","      res.send(err);","    }else{","      res.send('<script>alert(\"게시글을 삭제 했습니다.\"); location.href=\"/job/\";</script>');","    }","  })","});","","router.post('/img/upload',img.single('uploadFile'),function(req,res){","  var path = \"public/img/job/\";","  var imgUrl;","  fs.rename(path + req.file.filename,path + req.file.originalname,function(err){","    console.error(err);","  });","","  imgUrl = \"http://localhost:3000/public/img/job/\" + req.file.originalname;","  res.send(imgUrl);","});","","router.post('/file/upload',file.single('uploadFile'),function(req,res){","  var path = \"public/file/job/\";","  fs.rename(path + req.file.filename,path + req.file.originalname,function(err){","    console.log(err);","  });","  res.send(\"success\");","});","","module.exports = router;",""],"id":89}],[{"start":{"row":0,"column":0},"end":{"row":20,"column":0},"action":"insert","lines":["$(document).ready(function(){","\tvar wid = $('.dft_imgContainer').outerWidth() + $('.menue-container').width();","\t$('#mainContents').css('width','100%').css('width','-='+ wid +'px');","})","","function moveWrite(){","    window.location.href = \"/english/write\";","}","","function getDetail(id){","    window.location.href = \"/english/detail/get?category='english'&index=\"+id;","}","","function deleteArticle(id){","    window.location.href = '/english/delete?id=' + id;","}","","function updateArticle(id){","    window.location.href = '/english/update/get?id=' + id;","}",""],"id":90}],[{"start":{"row":6,"column":29},"end":{"row":6,"column":36},"action":"remove","lines":["english"],"id":91},{"start":{"row":6,"column":29},"end":{"row":6,"column":30},"action":"insert","lines":["j"]}],[{"start":{"row":6,"column":30},"end":{"row":6,"column":31},"action":"insert","lines":["o"],"id":92}],[{"start":{"row":6,"column":31},"end":{"row":6,"column":32},"action":"insert","lines":["b"],"id":93}],[{"start":{"row":10,"column":29},"end":{"row":10,"column":36},"action":"remove","lines":["english"],"id":94},{"start":{"row":10,"column":29},"end":{"row":10,"column":30},"action":"insert","lines":["j"]}],[{"start":{"row":10,"column":30},"end":{"row":10,"column":31},"action":"insert","lines":["o"],"id":95}],[{"start":{"row":10,"column":31},"end":{"row":10,"column":32},"action":"insert","lines":["b"],"id":96}],[{"start":{"row":10,"column":54},"end":{"row":10,"column":61},"action":"remove","lines":["english"],"id":97},{"start":{"row":10,"column":54},"end":{"row":10,"column":55},"action":"insert","lines":["j"]}],[{"start":{"row":10,"column":55},"end":{"row":10,"column":56},"action":"insert","lines":["o"],"id":98}],[{"start":{"row":10,"column":56},"end":{"row":10,"column":57},"action":"insert","lines":["b"],"id":99}],[{"start":{"row":14,"column":29},"end":{"row":14,"column":36},"action":"remove","lines":["english"],"id":100},{"start":{"row":14,"column":29},"end":{"row":14,"column":30},"action":"insert","lines":["j"]}],[{"start":{"row":14,"column":30},"end":{"row":14,"column":31},"action":"insert","lines":["o"],"id":101}],[{"start":{"row":14,"column":31},"end":{"row":14,"column":32},"action":"insert","lines":["b"],"id":102}],[{"start":{"row":18,"column":29},"end":{"row":18,"column":36},"action":"remove","lines":["english"],"id":103},{"start":{"row":18,"column":29},"end":{"row":18,"column":30},"action":"insert","lines":["j"]}],[{"start":{"row":18,"column":30},"end":{"row":18,"column":31},"action":"insert","lines":["o"],"id":104}],[{"start":{"row":18,"column":31},"end":{"row":18,"column":32},"action":"insert","lines":["b"],"id":105}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":7,"column":1},"end":{"row":7,"column":1},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":5,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1487530723807,"hash":"10f22c4468ae80ff4fc2a2cb70a9551a5d2c7b18"}